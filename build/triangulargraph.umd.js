var __accessCheck=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},__privateGet=(t,e,i)=>(__accessCheck(t,e,"read from private field"),i?i.call(t):e.get(t)),__privateAdd=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},__privateSet=(t,e,i,o)=>(__accessCheck(t,e,"write to private field"),o?o.call(t,i):e.set(t,i),i);!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TrianglarGraph=e()}(this,(function(){var t,e,i,o,a,s;const n=Math.sin(Math.PI/3),r=Math.cos(Math.PI/3),l=n/r;function d(t,e,i){return[e*r+t,(1-e)*n]}function h(t,e,i){return t[0]*=e,t[1]*=e,i?(t[0]+=i[0],t[1]+=i[1],t):t}return t=new WeakMap,e=new WeakMap,i=new WeakMap,o=new WeakMap,a=new WeakMap,s=new WeakMap,class{constructor(n,r){var l;if(__privateAdd(this,t,void 0),__privateAdd(this,e,void 0),__privateAdd(this,i,void 0),__privateAdd(this,o,void 0),__privateAdd(this,a,void 0),__privateAdd(this,s,void 0),__privateSet(this,o,!1),__privateSet(this,s,{width:600,height:400,offsets:{title:[300,0],subtitle:[300,0],triangle:[150,100],axisTitle:80},fontSizes:{title:24,subtitle:20,axisTitle:24,tickText:12,tooltipTitle:13,tooltipDetail:11},sizes:{triangle:300,dotSize:28,tickLength:10}}),!r)throw"options are needed.";__privateSet(this,i,r);const d=__privateGet(this,s),h=__privateGet(this,i);d.width=h.width||d.width,d.height=h.height||d.height;const f=document.querySelector(n);if(!f)throw`The elment ${n} cannot be found.`;__privateSet(this,t,document.createElement("div")),__privateGet(this,t).className="graph-container",Object.assign(__privateGet(this,t).style,{height:d.height+"px",width:d.width+"px",position:"relative"});const c=document.createElement("canvas");c.width=d.width,c.height=d.height,c.style.position="absolute",f.appendChild(__privateGet(this,t)),__privateGet(this,t).appendChild(c);const _=c.getContext("2d",{alpha:!1});_.fillStyle="white",_.fillRect(0,0,d.width,d.height),__privateSet(this,e,_),__privateSet(this,o,!(null==(l=h.tooltip)?void 0:l.disable)),this.render(h.data)}get domElement(){return __privateGet(this,t)}render(t){t||(t=__privateGet(this,i).data);const e=performance.now();this.calcLayout(),this.drawTitles(__privateGet(this,i).title,__privateGet(this,i).subtitle),this.drawTriangleBody(),this.drawAxes(__privateGet(this,i).axis),this.drawDataSet(t),this.drawTooltipLayer(__privateGet(this,i).tooltip),console.debug(`Rendering ${t.length} points took ${performance.now()-e} ms.`)}calcLayout(){var t,e;const{title:o,subtitle:a,axis:n}=__privateGet(this,i),r=__privateGet(this,s),l=r.width,d=r.height,h=Math.min(l,d),f=Math.round(.04*h),c=Math.round(.75*f);r.fontSizes.title=(null==o?void 0:o.fontSize)||f,r.fontSizes.subtitle=(null==a?void 0:a.fontSize)||c,r.fontSizes.axisTitle=(null==(e=null==(t=null==n?void 0:n.titles)?void 0:t[0])?void 0:e.fontSize)||f,r.fontSizes.tickText=Math.round(f/2);const _=r.offsets,p=Math.round(d/50);let v=4*p;o&&!o.disable&&(_.title[0]=Math.round(l/2),_.title[1]=v,v+=r.fontSizes.title,v+=p),a&&!a.disable&&(_.subtitle[0]=Math.round(l/2),_.subtitle[1]=v,v+=r.fontSizes.subtitle),v+=3*p;const x=r.fontSizes.axisTitle;r.offsets.axisTitle=2.8*x;const g=Math.min(d-v-2*p-x,l-2*x-4*p);r.sizes.triangle=g,r.sizes.tickLength=.02*g,_.triangle[0]=Math.round(l/2-g/2),_.triangle[1]=v,console.log(__privateGet(this,s))}drawTitles(t,i){if(!t||t.disable)return;const o=__privateGet(this,e),{offsets:a,fontSizes:n}=__privateGet(this,s);if(o.textAlign="center",o.textBaseline="top",t&&!t.disable){o.translate(a.title[0],a.title[1]),o.fillStyle=t.color||"#000000";const e=n.title,i=t.font||"Arial";o.font=`bold ${e}px ${i}`,o.fillText(t.text,0,0),o.resetTransform()}if(i&&!i.disable){o.translate(a.subtitle[0],a.subtitle[1]),o.fillStyle=i.color||"#000";const t=n.subtitle,e=i.font||"Times New Roman";o.font=`${t}px ${e}`,o.fillText(i.text,0,0)}o.resetTransform()}drawTriangleBody(){const t=__privateGet(this,s).sizes.triangle,i=__privateGet(this,e);i.fillStyle="#fdfdfdff";const o=t*n;i.translate(__privateGet(this,s).offsets.triangle[0],__privateGet(this,s).offsets.triangle[1]),i.beginPath(),i.strokeStyle="black",i.lineWidth=1,i.moveTo(0,o),i.lineTo(Math.round(.5*t),0),i.lineTo(t,o),i.lineTo(0,o),i.stroke(),i.fill(),i.resetTransform()}drawAxes(t){t||(t={});const i=__privateGet(this,e);i.translate(__privateGet(this,s).offsets.triangle[0],__privateGet(this,s).offsets.triangle[1]),this.drawTicks(t.ticks),this.drawAxisTitle(t.titles),i.resetTransform()}drawTicks(t){t||(t={});const i=__privateGet(this,s),o=i.sizes.tickLength,a=3*o;if(t.disable)return;const l=__privateGet(this,s).sizes.triangle,f=__privateGet(this,e);f.textAlign="center",f.textBaseline="middle",f.fillStyle="#000",f.font=`${i.fontSizes.tickText}px Arial`;const c="#0f0f0f1f";for(let e=1;e<=5;e++){f.strokeStyle="black";const i=d(.2*e,0);if(h(i,l),f.beginPath(),f.moveTo(i[0],i[1]),f.lineTo(i[0]-o*r,i[1]+o*n),f.stroke(),f.fillText(20*e+"%",i[0]-a*r,i[1]+a*n),!t.disableInnerLine){f.beginPath(),f.moveTo(...i);const o=d(.2*e,1-.2*e);h(o,l),f.strokeStyle=t.innerLineColor||c,f.lineTo(...o),f.stroke()}}for(let e=1;e<=5;e++){f.strokeStyle="black";const i=d(1-.2*e,.2*e);if(h(i,l),f.beginPath(),f.moveTo(i[0],i[1]),f.lineTo(i[0]+o,i[1]),f.stroke(),f.fillText(20*e+"%",i[0]+a,i[1]),!t.disableInnerLine){f.beginPath(),f.moveTo(...i);const o=d(0,.2*e);h(o,l),f.strokeStyle=t.innerLineColor||c,f.lineTo(...o),f.stroke()}}for(let e=1;e<=5;e++){f.strokeStyle="black";const i=d(0,1-.2*e);if(h(i,l),f.beginPath(),f.moveTo(i[0],i[1]),f.lineTo(i[0]-o*r,i[1]-o*n),f.stroke(),f.fillText(20*e+"%",i[0]-a*r,i[1]-a*n),!t.disableInnerLine){f.beginPath(),f.moveTo(...i);const o=d(1-.2*e,0);h(o,l),f.strokeStyle=t.innerLineColor||c,f.lineTo(...o),f.stroke()}}}drawAxisTitle(t){if(!t)return;const i=__privateGet(this,s).sizes.triangle,o=__privateGet(this,s).offsets.axisTitle,a=__privateGet(this,e),n=__privateGet(this,s).fontSizes.axisTitle;if(a.font=`${n}px Arial`,a.fillStyle="black",a.textAlign="center",a.textBaseline="middle",!t[0].disable){(t[0].fontSize||t[0].font)&&(a.font=`${t[0].fontSize||n}px ${t[0].font||"Arial"}`);const e=d(.5,0);h(e,i,[0,o]),a.beginPath(),a.fillText(t[0].text,...e)}if(!t[1].disable){(t[1].fontSize||t[1].font)&&(a.font=`${t[1].fontSize||n}px ${t[1].font||"Arial"}`);const e=d(.5,.5);h(e,i,[o,0]),a.save(),a.translate(...e),a.rotate(Math.PI/3),a.beginPath(),a.fillText(t[1].text,0,0),a.restore()}if(!t[2].disable){(t[2].fontSize||t[2].font)&&(a.font=`${t[2].fontSize||n}px ${t[2].font||"Arial"}`);const e=d(0,.5);h(e,i,[-o,0]),a.save(),a.translate(...e),a.beginPath(),a.rotate(-Math.PI/3),a.textBaseline="middle",a.fillText(t[2].text,0,0),a.restore()}}drawDataSet(t){if(!t||0===t.length)return;this.data=t;const i=__privateGet(this,s),a=__privateGet(this,s).sizes.triangle;let l,d;const h=__privateGet(this,e);h.translate(__privateGet(this,s).offsets.triangle[0],__privateGet(this,s).offsets.triangle[1]);const f=2*Math.PI;h.strokeStyle="dodgerblue";const c=__privateGet(this,o);for(let e=0,o=t.length;e<o;e++){l=t[e],d=this.data[e];let o=l.dotSize||5,s=l.coordinate[0],_=l.coordinate[1],p=l.coordinate[2],v=_*r+s,x=(1-_)*n;v=Math.round(a*v),x=Math.round(a*x);const g=l.imageSize||i.sizes.dotSize;if("image"===l.type&&l.imageURL){const t=new Image;t.src=l.imageURL,t.onload=()=>{createImageBitmap(t,0,0,t.width,t.height).then((t=>{this.data[e].image=t,h.drawImage(t,v-g/2,x-g/2,g,g)}))}}else l.dotColor&&(h.fillStyle=l.dotColor),l.dotSize&&(o=l.dotSize),h.beginPath(),h.arc(v,x,o,0,f),h.fill();c&&(d.xyCoord=[v,x],d.squareRadius=o**2,d.uAxisCoord=[Math.round(s*a),Math.round(n*a)],d.vAxisCoord=[Math.round((_*r+1-_)*a),Math.round((1-_)*n*a)],d.wAxisCoord=[Math.round((1-p)*r*a),Math.round(p*n*a)])}}drawTooltipLayer(e){if(!this.data)return;const o=document.createElement("canvas");__privateGet(this,t).appendChild(o);const a=__privateGet(this,s);Object.assign(o.style,{position:"absolute",top:"0",left:"0"}),o.height=a.height,o.width=a.width;const n=20;let r=a.fontSizes.tooltipTitle,d=a.fontSizes.tooltipDetail,h=16+r+3*d+12,f=100;const c=__privateGet(this,s).offsets.triangle;o.addEventListener("mousemove",(t=>{requestAnimationFrame((()=>{var e,s,v,x,g;const u=function(t,e,i){let o;for(let a=0,s=i.length;a<s;a++){o=i[a];if((t-o.xyCoord[0])**2+(e-o.xyCoord[1])**2<o.squareRadius)return o}}(t.offsetX-c[0],t.offsetY-c[1],this.data);if(_.clearRect(-c[0],-c[1],o.width,o.height),!u)return;const T=u.imageSize||a.sizes.dotSize;_.setLineDash([8,4]),_.beginPath(),_.moveTo(...u.xyCoord),_.lineTo(...u.uAxisCoord),_.stroke(),_.beginPath(),_.moveTo(...u.xyCoord),_.lineTo(...u.vAxisCoord),_.stroke(),_.beginPath(),_.moveTo(...u.xyCoord),_.lineTo(...u.wAxisCoord),_.stroke();let m=u.xyCoord[0]+40,S=u.xyCoord[1]-n*l-h/2;_.beginPath(),_.setLineDash([]),_.moveTo(...u.xyCoord),_.lineTo(u.xyCoord[0]+n,u.xyCoord[1]-n*l),_.lineTo(u.xyCoord[0]+40,u.xyCoord[1]-n*l),_.fillStyle="#fff",_.fillRect(m,S,f,h),_.rect(m,S,f,h),_.stroke(),_.fillStyle="#000",_.font=`${r}px Arial`,_.fillText(u.title||"",m+12,S+8);const b=_.measureText(u.title||"").width,y=null==(s=null==(e=__privateGet(this,i))?void 0:e.axis)?void 0:s.titles;_.font=`${d}px Arial`;const w=`${(null==(v=null==y?void 0:y[0])?void 0:v.text)||"U"}: ${(100*u.coordinate[0]).toFixed(2)}%`;_.fillText(w,m+12,S+8+r+4);const k=_.measureText(w).width,G=`${(null==(x=null==y?void 0:y[1])?void 0:x.text)||"V"}: ${(100*u.coordinate[1]).toFixed(2)}%`;_.fillText(G,m+12,S+8+r+8+d);const z=_.measureText(G).width,C=`${(null==(g=null==y?void 0:y[2])?void 0:g.text)||"W"}: ${(100*u.coordinate[2]).toFixed(2)}%`;_.fillText(C,m+12,S+8+r+12+2*d);const M=_.measureText(C).width;f=Math.max(b,k,z,M)+24,"image"===u.type&&u.image?(_.drawImage(u.image,u.xyCoord[0]-T/2,u.xyCoord[1]-T/2,T,T),_.beginPath(),_.arc(...u.xyCoord,T/2,0,2*Math.PI),_.stroke()):(_.beginPath(),_.fillStyle=u.dotColor||p,_.arc(...u.xyCoord,u.dotSize,0,2*Math.PI),_.fill(),_.beginPath(),_.arc(...u.xyCoord,u.dotSize,0,2*Math.PI),_.stroke())}))}));const _=o.getContext("2d");_.translate(c[0],c[1]);const p="#000e";_.strokeStyle=p,_.textAlign="left",_.textBaseline="top"}destroy(){__privateGet(this,t).remove()}}}));
